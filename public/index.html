<!doctype html>
<html ng-app="app">
  <head>
    <title>Whois.IO</title>
    <style media="screen">
      body {
        font-family: Roboto, Arial, sans-serif;
        background: #ECEFF1;
        color: rgba(0,0,0,0.87);
      }

      a {
        color: rgb(3,155,229);
        text-decoration: none; 
      }
      a:hover{
        text-decoration: none;
      }
      #message {
        max-width: 800px;
        margin: 40px auto;
        box-shadow: 0 1px 3px 0 rgba(0,0,0,0.2),0 1px 1px 0 rgba(0,0,0,0.14),0 2px 1px -1px rgba(0,0,0,0.12);
        border-radius: 2px;
        background: white;
        padding: 16px 24px;
        text-align: center;
      }

      #message h1 {
        font-size: 22px;
        font-weight: 500;
        text-align: center;
        margin: 0 0 16px;
      }

      #message p {
        font-weight: 300;
        line-height: 150%;
      }

      #data li {
        list-style: none;
        margin: 10px -50px 0;
        padding: 0;
        text-align: left;
      }

      .btn{
        display: inline-block;
        padding: 8px;
        text-transform: uppercase;
        text-decoration: none;
        font-weight: 500;
        background: rgb(3,155,229);
        color: white;
        border: 1px solid rgb(3,155,229);
        border-radius: 3px;
        font-size: 14px;
        box-shadow: 0 2px 5px 0 rgba(0,0,0,.26);
        cursor: pointer;
      }
      img{
        padding: 5px;
      }
      #user {
        box-shadow: 0 1px 3px 0 rgba(0,0,0,0.2),0 1px 1px 0 rgba(0,0,0,0.14),0 2px 1px -1px rgba(0,0,0,0.12);
        border-radius: 2px;
        background: white;
        padding: 5px 5px;
        text-align: left;
        position: fixed;
        border-top: 5px solid #26C6DA;
        right: 20px;
        top:10px;
      }
      #rank {
        box-shadow: 0 1px 3px 0 rgba(0,0,0,0.2),0 1px 1px 0 rgba(0,0,0,0.14),0 2px 1px -1px rgba(0,0,0,0.12);
        border-radius: 2px;
        background: white;
        padding: 10px;
        width: 300px;
        height: 500px;
        text-align: left;
        position: fixed;
        border-top: 5px solid #26C6DA;
        right: 5px;
        bottom: 0px;
      }
      footer{
        position: absolute;
        bottom: 2px;
        text-align: center;
        margin: auto;
        width: 100%;
      }
    </style>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
    <script src="./js/angular-facebook.min.js"></script>
    <script src="./js/socket.io.js"></script>
  </head>

  <body ng-controller="con" ng-init="checkFB()">
    <div id="message" ng-show="!loggedIn">
      <img ng-src="http://www.wmfirstassembly.com/wp-content/uploads/2015/04/who-am-i.jpg"><br>
      <button class="btn" ng-click="login()">Login with facebook</button>
    </div>
    <div id="user" class="row" ng-show="loggedIn">
      <div class="col-md-4">
        <img ng-src="{{user.picture.data.url}}">
      </div>
      <div class="col-md-8">
        <a href='http://fb.com/{{user.id}}' target='_blank'>{{user.name}}</a>
        <br>
        score : {{score}}
      </div>
    </div>

    <div id="rank" ng-show="loggedIn">
      User Online (<a id="online"></a>)
      ___________________________________<br>
      <div>
        <ul id="data"></ul>
      </div>
    </div>

    <footer>
      <a href="https://who-ami.herokuapp.com/">K I R I N</a>
      <br>Used <a href="https://www.google.com/intl/th/chrome/browser/desktop/">Google Chrome </a>Only Power by <a href="http://heroku.com/">Heroku</a> &copy; 2016
    </footer>

<img ng-src="{{datas.picture.data.url}}"><a href='http://fb.com/{{datas.id}}' target='_blank'>{{datas.name}}</a>
  <script>
    var socket = io();
    var app = angular.module('app', ['facebook'])
    app.config(function(FacebookProvider) {
      FacebookProvider.init('573083182871799');
    })

    app.controller('con', function($scope, Facebook) {

    socket.on('login', function(data){
      data.sort($scope.sort);
      var display;
      for(var i=0;i<data.length;i++){
        //http://www.devcurry.com/2010/05/sorting-json-array.html
        display =+ "<li><img src='"+data[i].avatar+"'/><a href='http://fb.com/"+data[i].id+"' target='_blank'>"+data[i].name+"</a> : "+data[i].score+"</li>";
        //$('#data').append("<li><img src='"+data[i].avatar+"'/><a href='http://fb.com/"+data[i].id+"' target='_blank'>"+data[i].name+"</a> : "+data[i].score+"</li>");  // recieve
      }
      $('#data').html(display);
    });

    $scope.sort = function(x,y) {
      return x.score - y.score; 
    }
    $scope.checkFB = function(){
      Facebook.getLoginStatus(function(response) {
        if(response.status === 'connected') {
          $scope.login();
        }
      });
    }
    $scope.login = function() {
      // From now on you can use the Facebook service just as Facebook api says
      Facebook.login(function(response) {
        // Do something with response.
        if(response.status === 'connected') {
          $scope.loggedIn = true;
          $scope.me();
          socket.on('online',function(online){
            document.getElementById("online").innerHTML = online;
          });
        } else {
          $scope.loggedIn = false;
        }
      });
    };
    $scope.me = function() {
      Facebook.api('/me?fields=id,name,picture', function(response) {
        $scope.user = response;
        socket.emit('login', $scope.user); // send
        
      });
    };
  });
  </script>
  </body>
</html>